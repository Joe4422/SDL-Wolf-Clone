#define _USE_MATH_DEFINES

/******************************************************************************
 * Includes
 *****************************************************************************/
#include "angle.h"
#include <math.h>
#include <stdlib.h>

/******************************************************************************
 * Defines
 *****************************************************************************/
#define MAX_ANGLE	(360)
#define MIN_ANGLE	(0)

/******************************************************************************
 * Local variables
 *****************************************************************************/
const float	sinLookupTable[MAX_ANGLE] =
{
	0.000000, 0.017452, 0.034899, 0.052336, 0.069756, 0.087156, 0.104528, 0.121869, 0.139173, 0.156434,
	0.173648, 0.190809, 0.207912, 0.224951, 0.241922, 0.258819, 0.275637, 0.292372, 0.309017, 0.325568,
	0.342020, 0.358368, 0.374607, 0.390731, 0.406737, 0.422618, 0.438371, 0.453991, 0.469472, 0.484810,
	0.500000, 0.515038, 0.529919, 0.544639, 0.559193, 0.573576, 0.587785, 0.601815, 0.615661, 0.629320,
	0.642788, 0.656059, 0.669131, 0.681998, 0.694658, 0.707107, 0.719340, 0.731354, 0.743145, 0.754710,
	0.766044, 0.777146, 0.788011, 0.798636, 0.809017, 0.819152, 0.829038, 0.838671, 0.848048, 0.857167,
	0.866025, 0.874620, 0.882948, 0.891007, 0.898794, 0.906308, 0.913545, 0.920505, 0.927184, 0.933580,
	0.939693, 0.945519, 0.951057, 0.956305, 0.961262, 0.965926, 0.970296, 0.974370, 0.978148, 0.981627,
	0.984808, 0.987688, 0.990268, 0.992546, 0.994522, 0.996195, 0.997564, 0.998630, 0.999391, 0.999848,
	1.000000, 0.999848, 0.999391, 0.998630, 0.997564, 0.996195, 0.994522, 0.992546, 0.990268, 0.987688,
	0.984808, 0.981627, 0.978148, 0.974370, 0.970296, 0.965926, 0.961262, 0.956305, 0.951057, 0.945519,
	0.939693, 0.933580, 0.927184, 0.920505, 0.913545, 0.906308, 0.898794, 0.891006, 0.882948, 0.874620,
	0.866025, 0.857167, 0.848048, 0.838671, 0.829038, 0.819152, 0.809017, 0.798635, 0.788011, 0.777146,
	0.766044, 0.754710, 0.743145, 0.731354, 0.719340, 0.707107, 0.694658, 0.681998, 0.669131, 0.656059,
	0.642788, 0.629320, 0.615661, 0.601815, 0.587785, 0.573576, 0.559193, 0.544639, 0.529919, 0.515038,
	0.500000, 0.484810, 0.469472, 0.453991, 0.438371, 0.422618, 0.406737, 0.390731, 0.374606, 0.358368,
	0.342020, 0.325568, 0.309017, 0.292372, 0.275637, 0.258819, 0.241922, 0.224951, 0.207912, 0.190809,
	0.173648, 0.156434, 0.139173, 0.121869, 0.104528, 0.087156, 0.069756, 0.052336, 0.034899, 0.017452,
	-0.000000, -0.017452, -0.034899, -0.052336, -0.069756, -0.087156, -0.104528, -0.121869, -0.139173, -0.156434,
	-0.173648, -0.190809, -0.207912, -0.224951, -0.241922, -0.258819, -0.275637, -0.292372, -0.309017, -0.325568,
	-0.342020, -0.358368, -0.374607, -0.390731, -0.406737, -0.422618, -0.438371, -0.453991, -0.469472, -0.484810,
	-0.500000, -0.515038, -0.529919, -0.544639, -0.559193, -0.573576, -0.587785, -0.601815, -0.615661, -0.629320,
	-0.642788, -0.656059, -0.669131, -0.681998, -0.694658, -0.707107, -0.719340, -0.731354, -0.743145, -0.754710,
	-0.766045, -0.777146, -0.788011, -0.798635, -0.809017, -0.819152, -0.829038, -0.838671, -0.848048, -0.857167,
	-0.866025, -0.874620, -0.882948, -0.891006, -0.898794, -0.906308, -0.913545, -0.920505, -0.927184, -0.933580,
	-0.939693, -0.945519, -0.951056, -0.956305, -0.961262, -0.965926, -0.970296, -0.974370, -0.978148, -0.981627,
	-0.984808, -0.987688, -0.990268, -0.992546, -0.994522, -0.996195, -0.997564, -0.998630, -0.999391, -0.999848,
	-1.000000, -0.999848, -0.999391, -0.998630, -0.997564, -0.996195, -0.994522, -0.992546, -0.990268, -0.987688,
	-0.984808, -0.981627, -0.978148, -0.974370, -0.970296, -0.965926, -0.961262, -0.956305, -0.951056, -0.945519,
	-0.939693, -0.933580, -0.927184, -0.920505, -0.913545, -0.906308, -0.898794, -0.891006, -0.882948, -0.874620,
	-0.866025, -0.857167, -0.848048, -0.838671, -0.829038, -0.819152, -0.809017, -0.798635, -0.788011, -0.777146,
	-0.766045, -0.754710, -0.743145, -0.731354, -0.719340, -0.707107, -0.694658, -0.681998, -0.669131, -0.656059,
	-0.642788, -0.629320, -0.615661, -0.601815, -0.587785, -0.573577, -0.559193, -0.544639, -0.529919, -0.515038,
	-0.500000, -0.484809, -0.469471, -0.453991, -0.438371, -0.422618, -0.406736, -0.390731, -0.374607, -0.358368,
	-0.342020, -0.325568, -0.309017, -0.292372, -0.275638, -0.258819, -0.241922, -0.224951, -0.207912, -0.190809,
	-0.173648, -0.156434, -0.139173, -0.121869, -0.104529, -0.087156, -0.069756, -0.052336, -0.034900, -0.017453
};

const float	cosLookupTable[MAX_ANGLE] =
{
	1.000000, 0.999848, 0.999391, 0.998630, 0.997564, 0.996195, 0.994522, 0.992546, 0.990268, 0.987688,
	0.984808, 0.981627, 0.978148, 0.974370, 0.970296, 0.965926, 0.961262, 0.956305, 0.951057, 0.945519,
	0.939693, 0.933580, 0.927184, 0.920505, 0.913545, 0.906308, 0.898794, 0.891007, 0.882948, 0.874620,
	0.866025, 0.857167, 0.848048, 0.838671, 0.829038, 0.819152, 0.809017, 0.798636, 0.788011, 0.777146,
	0.766044, 0.754710, 0.743145, 0.731354, 0.719340, 0.707107, 0.694658, 0.681998, 0.669131, 0.656059,
	0.642788, 0.629320, 0.615661, 0.601815, 0.587785, 0.573576, 0.559193, 0.544639, 0.529919, 0.515038,
	0.500000, 0.484810, 0.469472, 0.453991, 0.438371, 0.422618, 0.406737, 0.390731, 0.374607, 0.358368,
	0.342020, 0.325568, 0.309017, 0.292372, 0.275637, 0.258819, 0.241922, 0.224951, 0.207912, 0.190809,
	0.173648, 0.156434, 0.139173, 0.121869, 0.104528, 0.087156, 0.069757, 0.052336, 0.034899, 0.017452,
	-0.000000, -0.017452, -0.034899, -0.052336, -0.069756, -0.087156, -0.104529, -0.121869, -0.139173, -0.156434,
	-0.173648, -0.190809, -0.207912, -0.224951, -0.241922, -0.258819, -0.275637, -0.292372, -0.309017, -0.325568,
	-0.342020, -0.358368, -0.374607, -0.390731, -0.406737, -0.422618, -0.438371, -0.453991, -0.469472, -0.484810,
	-0.500000, -0.515038, -0.529919, -0.544639, -0.559193, -0.573576, -0.587785, -0.601815, -0.615661, -0.629320,
	-0.642788, -0.656059, -0.669131, -0.681998, -0.694658, -0.707107, -0.719340, -0.731354, -0.743145, -0.754710,
	-0.766044, -0.777146, -0.788011, -0.798635, -0.809017, -0.819152, -0.829038, -0.838671, -0.848048, -0.857167,
	-0.866025, -0.874620, -0.882948, -0.891006, -0.898794, -0.906308, -0.913545, -0.920505, -0.927184, -0.933580,
	-0.939693, -0.945519, -0.951057, -0.956305, -0.961262, -0.965926, -0.970296, -0.974370, -0.978148, -0.981627,
	-0.984808, -0.987688, -0.990268, -0.992546, -0.994522, -0.996195, -0.997564, -0.998630, -0.999391, -0.999848,
	-1.000000, -0.999848, -0.999391, -0.998630, -0.997564, -0.996195, -0.994522, -0.992546, -0.990268, -0.987688,
	-0.984808, -0.981627, -0.978148, -0.974370, -0.970296, -0.965926, -0.961262, -0.956305, -0.951057, -0.945519,
	-0.939693, -0.933580, -0.927184, -0.920505, -0.913545, -0.906308, -0.898794, -0.891007, -0.882948, -0.874620,
	-0.866025, -0.857167, -0.848048, -0.838671, -0.829038, -0.819152, -0.809017, -0.798636, -0.788011, -0.777146,
	-0.766044, -0.754710, -0.743145, -0.731354, -0.719340, -0.707107, -0.694658, -0.681998, -0.669131, -0.656059,
	-0.642787, -0.629320, -0.615662, -0.601815, -0.587785, -0.573576, -0.559193, -0.544639, -0.529919, -0.515038,
	-0.500000, -0.484810, -0.469472, -0.453991, -0.438371, -0.422618, -0.406737, -0.390731, -0.374607, -0.358368,
	-0.342020, -0.325568, -0.309017, -0.292372, -0.275637, -0.258819, -0.241922, -0.224951, -0.207912, -0.190809,
	-0.173648, -0.156435, -0.139173, -0.121869, -0.104528, -0.087156, -0.069757, -0.052336, -0.034899, -0.017452,
	0.000000, 0.017452, 0.034899, 0.052336, 0.069757, 0.087156, 0.104528, 0.121869, 0.139173, 0.156435,
	0.173648, 0.190809, 0.207911, 0.224951, 0.241922, 0.258819, 0.275637, 0.292371, 0.309017, 0.325568,
	0.342020, 0.358368, 0.374607, 0.390731, 0.406737, 0.422618, 0.438371, 0.453991, 0.469472, 0.484810,
	0.500000, 0.515038, 0.529919, 0.544639, 0.559193, 0.573576, 0.587785, 0.601815, 0.615662, 0.629320,
	0.642788, 0.656059, 0.669131, 0.681998, 0.694658, 0.707107, 0.719340, 0.731354, 0.743145, 0.754710,
	0.766044, 0.777146, 0.788011, 0.798636, 0.809017, 0.819152, 0.829038, 0.838671, 0.848048, 0.857167,
	0.866025, 0.874620, 0.882948, 0.891007, 0.898794, 0.906308, 0.913546, 0.920505, 0.927184, 0.933580,
	0.939693, 0.945519, 0.951057, 0.956305, 0.961262, 0.965926, 0.970296, 0.974370, 0.978148, 0.981627,
	0.984808, 0.987688, 0.990268, 0.992546, 0.994522, 0.996195, 0.997564, 0.998630, 0.999391, 0.999848
};

const float	tanLookupTable[MAX_ANGLE] =
{
	0.000000, 0.017455, 0.034921, 0.052408, 0.069927, 0.087489, 0.105104, 0.122785, 0.140541, 0.158384,
	0.176327, 0.194380, 0.212557, 0.230868, 0.249328, 0.267949, 0.286745, 0.305731, 0.324920, 0.344328,
	0.363970, 0.383864, 0.404026, 0.424475, 0.445229, 0.466308, 0.487733, 0.509525, 0.531709, 0.554309,
	0.577350, 0.600861, 0.624869, 0.649408, 0.674508, 0.700208, 0.726543, 0.753554, 0.781286, 0.809784,
	0.839100, 0.869287, 0.900404, 0.932515, 0.965689, 1.000000, 1.035530, 1.072369, 1.110613, 1.150368,
	1.191754, 1.234897, 1.279942, 1.327045, 1.376382, 1.428148, 1.482561, 1.539865, 1.600334, 1.664280,
	1.732051, 1.804048, 1.880726, 1.962610, 2.050304, 2.144507, 2.246037, 2.355853, 2.475087, 2.605089,
	2.747477, 2.904211, 3.077684, 3.270853, 3.487414, 3.732050, 4.010781, 4.331476, 4.704631, 5.144556,
	5.671280, 6.313751, 7.115370, 8.144348, 9.514368, 11.430045, 14.300659, 19.081130, 28.636256, 57.290038,
	-22877332.428855, -57.290143, -28.636282, -19.081142, -14.300665, -11.430049, -9.514360, -8.144350, -7.115371, -6.313752,
	-5.671282, -5.144553, -4.704629, -4.331477, -4.010781, -3.732051, -3.487414, -3.270852, -3.077683, -2.904211,
	-2.747478, -2.605089, -2.475087, -2.355852, -2.246036, -2.144506, -2.050304, -1.962610, -1.880726, -1.804048,
	-1.732051, -1.664280, -1.600334, -1.539865, -1.482561, -1.428148, -1.376382, -1.327045, -1.279942, -1.234897,
	-1.191754, -1.150369, -1.110612, -1.072369, -1.035530, -1.000000, -0.965689, -0.932515, -0.900404, -0.869287,
	-0.839100, -0.809784, -0.781286, -0.753554, -0.726542, -0.700208, -0.674508, -0.649408, -0.624869, -0.600861,
	-0.577350, -0.554309, -0.531709, -0.509526, -0.487733, -0.466308, -0.445229, -0.424475, -0.404026, -0.383864,
	-0.363970, -0.344328, -0.324920, -0.305731, -0.286745, -0.267949, -0.249328, -0.230868, -0.212556, -0.194380,
	-0.176327, -0.158384, -0.140541, -0.122784, -0.105104, -0.087489, -0.069927, -0.052408, -0.034921, -0.017455,
	0.000000, 0.017455, 0.034921, 0.052408, 0.069927, 0.087489, 0.105104, 0.122785, 0.140541, 0.158384,
	0.176327, 0.194380, 0.212557, 0.230868, 0.249328, 0.267949, 0.286745, 0.305731, 0.324920, 0.344328,
	0.363970, 0.383864, 0.404026, 0.424475, 0.445229, 0.466308, 0.487732, 0.509526, 0.531709, 0.554309,
	0.577350, 0.600860, 0.624869, 0.649407, 0.674509, 0.700207, 0.726543, 0.753554, 0.781285, 0.809784,
	0.839100, 0.869287, 0.900404, 0.932515, 0.965689, 1.000000, 1.035530, 1.072369, 1.110613, 1.150368,
	1.191754, 1.234897, 1.279942, 1.327044, 1.376383, 1.428148, 1.482561, 1.539865, 1.600334, 1.664280,
	1.732051, 1.804048, 1.880726, 1.962610, 2.050305, 2.144507, 2.246037, 2.355852, 2.475085, 2.605090,
	2.747478, 2.904211, 3.077682, 3.270850, 3.487417, 3.732052, 4.010780, 4.331473, 4.704625, 5.144558,
	5.671283, 6.313749, 7.115362, 8.144362, 9.514376, 11.430056, 14.300652, 19.081075, 28.636425, 57.290325,
	-83858283.006641, -57.290247, -28.636406, -19.081067, -14.300647, -11.430053, -9.514374, -8.144360, -7.115361, -6.313748,
	-5.671283, -5.144557, -4.704635, -4.331473, -4.010780, -3.732051, -3.487416, -3.270855, -3.077682, -2.904210,
	-2.747478, -2.605090, -2.475085, -2.355852, -2.246037, -2.144507, -2.050305, -1.962610, -1.880726, -1.804048,
	-1.732051, -1.664280, -1.600334, -1.539865, -1.482561, -1.428148, -1.376383, -1.327044, -1.279941, -1.234897,
	-1.191754, -1.150369, -1.110612, -1.072369, -1.035530, -1.000000, -0.965688, -0.932515, -0.900404, -0.869287,
	-0.839100, -0.809784, -0.781285, -0.753554, -0.726543, -0.700208, -0.674508, -0.649407, -0.624869, -0.600861,
	-0.577351, -0.554309, -0.531709, -0.509525, -0.487733, -0.466308, -0.445228, -0.424475, -0.404026, -0.383864,
	-0.363970, -0.344327, -0.324920, -0.305731, -0.286746, -0.267949, -0.249328, -0.230868, -0.212557, -0.194380,
	-0.176327, -0.158384, -0.140541, -0.122785, -0.105104, -0.087488, -0.069927, -0.052408, -0.034921, -0.017455
};

/******************************************************************************
 * Function definitions
 *****************************************************************************/
ANGLE	Angle_Normalise
(
	ANGLE	angle
)
{
	while (angle >= MAX_ANGLE)
	{
		angle -= MAX_ANGLE;
	}
	while (angle < MIN_ANGLE)
	{
		angle += MAX_ANGLE;
	}

	return angle;
}

ANGLE	Angle_Add
(
	ANGLE	a,
	ANGLE	b
)
{
	return Angle_Normalise(a + b);
}

ANGLE	Angle_Sub
(
	ANGLE	a,
	ANGLE	b
)
{
	return Angle_Normalise(a - b);
}

float	Angle_Sin
(
	ANGLE	angle
)
{
	//return sinLookupTable[(uint16_t)Angle_Normalise(angle)];
	return sinf(Angle_Normalise(angle) * (M_PI / 180.0f));
}

float	Angle_Cos
(
	ANGLE	angle
)
{
	//return cosLookupTable[(uint16_t)Angle_Normalise(angle)];
	return cosf(Angle_Normalise(angle) * (M_PI / 180.0f));
}

float	Angle_Tan
(
	ANGLE	angle
)
{
	//return tanLookupTable[(uint16_t)Angle_Normalise(angle)];
	return tanf(Angle_Normalise(angle) * (M_PI / 180.0f));
}

ANGLE	Angle_InvTan
(
	float	ft
)
{
	// int i;

	// for (i = MIN_ANGLE; i <= MAX_ANGLE - 1; i++)
	// {
	// 	if (tanLookupTable[i] <= ft && tanLookupTable[i + 1] >= ft)
	// 	{
	// 		return i;
	// 	}
	// }
	
	// return 0;
	return atanf(ft) * (180.0F / M_PI);
}